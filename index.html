<script>
    function generatePrompt() {
        // 1. Capturar valores
        const rol = document.getElementById('input-rol').value.trim();
        const contexto = document.getElementById('input-contexto').value.trim();
        const tarea = document.getElementById('input-tarea').value.trim();
        const formato = document.getElementById('input-formato').value.trim();
        const ejemplo = document.getElementById('input-ejemplo').value.trim();

        // Validación simple
        if (!rol && !tarea) {
            alert("Por favor, llena al menos el ROL y la TAREA para generar un prompt útil.");
            return;
        }

        // 2. Construir el Prompt Estructurado (Ingeniería de Prompts)
        let finalPrompt = "";

        if (rol) finalPrompt += `### ROL\nActúa como ${rol}.\n\n`;
        if (contexto) finalPrompt += `### CONTEXTO\n${contexto}\n\n`;
        if (tarea) finalPrompt += `### TAREA\n${tarea}\n\n`;
        if (formato) finalPrompt += `### FORMATO DE SALIDA\n${formato}\n\n`;
        if (ejemplo) finalPrompt += `### EJEMPLO DE REFERENCIA (Estilo/Estructura)\n"""\n${ejemplo}\n"""\n\n`;

        // Instrucción de cierre para asegurar calidad
        finalPrompt += `---\nINSTRUCCIONES ADICIONALES:\n- Asegúrate de seguir estrictamente el formato solicitado.\n- Evita generalidades, sé específico y directo.\n- Si falta información crítica en el contexto, hazme una pregunta antes de generar la respuesta final.`;

        // 3. Mostrar resultado
        const outputArea = document.getElementById('output-area');
        outputArea.value = finalPrompt;

        // Ocultar empty state
        document.getElementById('empty-state').classList.add('hidden');

        // Rotar consejos
        rotateTip();
    }

    function copyToClipboard() {
        const outputArea = document.getElementById('output-area');
        if (!outputArea.value) return;

        outputArea.select();
        outputArea.setSelectionRange(0, 99999); // Móvil

        navigator.clipboard.writeText(outputArea.value).then(() => {
            showToast();
        });
    }

    function showToast() {
        const toast = document.getElementById('toast');
        toast.classList.remove('translate-y-20', 'opacity-0');
        setTimeout(() => {
            toast.classList.add('translate-y-20', 'opacity-0');
        }, 3000);
    }

    function clearFields() {
        if (confirm('¿Borrar todos los campos?')) {
            document.getElementById('input-rol').value = '';
            document.getElementById('input-contexto').value = '';
            document.getElementById('input-tarea').value = '';
            document.getElementById('input-formato').value = '';
            document.getElementById('input-ejemplo').value = '';
            document.getElementById('output-area').value = '';
            document.getElementById('empty-state').classList.remove('hidden');
        }
    }

    // --- Tips dinámicos ---
    const tips = [
        'El contexto es el rey. Si la IA alucina, suele ser porque le faltan datos de fondo en el bloque "Contexto".',
        'Mientras más claro sea el rol, más especializado será el lenguaje y la respuesta de la IA.',
        'Usa verbos de acción en la TAREA: analiza, compara, resume, diseña, corrige, etc.',
        'Define siempre el formato de salida: tabla, lista, pasos numerados o código.',
        'Agrega un ejemplo en el bloque "Ejemplo" para que la IA imite tono, estilo y estructura.'
    ];
    let tipIndex = 0;

    function rotateTip() {
        const tipElement = document.getElementById('dynamic-tip');
        if (!tipElement) return;

        tipIndex = (tipIndex + 1) % tips.length;
        tipElement.textContent = tips[tipIndex];
    }
</script>
